.page-header
  = link_to crawl_sites_path, method: :post, class: 'btn btn-primary' do
    %span.glyphicon.glyphicon-refresh
    Crawl Site
  = link_to new_site_path, class: 'btn btn-primary' do
    %span.glyphicon.glyphicon-plus
    New Site

  %h1 Listing sites

= search_form_for @q, method: :get, class: 'form-inline' do |f|
  .form-group
    = f.text_field :url_or_name_cont, placeholder: 'サイト名 or URL', size: 40, class: "form-control"
    = f.select :status_eq, Site.aasm(:status).states_for_select,{}, include_blank: true, class: "form-control"
    = f.submit '検索',  class: "btn btn-default"


.table-responsive
  %table.table.table-striped.table-bordered.table-hover
    %thead
      %tr
        %th.text-center.some{ :style => "width: 300px" }
          = sort_link @q, :name
        %th.text-center
          = sort_link @q, :url
        %th.text-center
          = sort_link @q, :status, 'Status'
        %th.text-center
          = sort_link @q, :last_crawled_at
        %th

    %tbody
      - @sites.each do |site|
        %tr
          %td= site.name
          %td= truncate site.try(:url) || '', length: 80
          %td.text-center= site.aasm(:status).human_state
          %td.text-right= time_ago_in_words site.last_crawled_at if site.last_crawled_at.present?
          %td.text-center= link_to 'Show', site_diffs_path(site)
  = paginate @sites